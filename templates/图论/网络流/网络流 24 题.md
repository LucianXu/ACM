# 最大流

# 费用流

## 1 汽车加油行驶问题

### 题意

在 $n \times n$ 的网格上，汽车要从 $(1, 1)$ 行驶至 $(n, n)$，要求花费最小，在行驶过程中满足如下要求：

1. 向右、下方向行驶没有花费；
2. 向左、上方向行驶花费为 $b$；
3. 汽车加满油可以行驶距离为 $k$；
4. 在矩阵值为 $1$ 的地方强制进行加油，油量加满，花费为 $a$；
5. 在矩阵值为 $0$ 的地方可以花费 $a + c$ 进行加油。

### 解法

事实上是分层图最短路，也可以把容量限制为 $1$ 跑费用流。

1. 对矩阵值为 $0$ 的每一点 $u$ 在每一层（除最底层）向下一层四周的节点建立容量为 $1$ 的弧，费用为 $0$ 或 $b$，再在每一层（除第一层）向第一层的这个点建立容量为 $1$ 的弧，费用为 $a+c$；
2. 对矩阵值为 $1$ 的每一点 $u$ 在第一层向下一层四周的节点建立容量为 $1$ 的弧，费用为 $0$ 或 $b$，再在每一层（除第一层）向第一层的这个点建立容量为 $1$ 的弧，费用为 $a$；
3. 源点设为第一层的 $(1, 1)$ 即可，将每一层的 $(n, n)$ 用容量为 $1$ 费用为 $0$ 的弧连接至某一个新设立的点，再将这一点用容量为 $1$ 费用为 $0$ 的弧连接至汇点。

## 2 太空飞行计划问题

### 题意

有 $n$ 个实验，$m$ 种仪器，每个实验有赞助经费，并且给出了实验所需要的仪器，每个仪器有各自的费用，要求做哪些实验、买哪些仪器可以使利润最大化。

### 解法

源点向每个实验连边，容量为实验经费，实验向所需器材连边，容量为无穷大，器材向汇点连边，容量为费用。

例如：

![graph.png](https://s2.loli.net/2022/12/24/NDdgyoi1TOvC7tR.png)

答案为所有实验的总经费减去最小割。

# 最小割

## 1 方格取数问题

### 题意

$n$ 行 $m$ 列的方格图，每个格子有一个权值，要求选取的格子权值最大，并且横竖相邻的格子不同时出现。

### 解法

对棋盘进行黑白交错染色，源点向黑格连边，白格向汇点连边，容量为格子中的权值，再由黑格向相邻的白格连边，容量为无穷大。

答案为所有格子的权值和减去最小割的值。

例如：

```
2 3
10 1 1
1 1 10
```

![image.png](https://s2.loli.net/2022/12/23/5TjckJpPWxoSdlh.png)